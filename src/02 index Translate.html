<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Stipend Analysis Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0a0a0a;
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: left;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .chart-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #ffffff;
        }
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        /* Define color variables - update these to match your legend colors */
        :root {
            --stipend-color: #fa8080;          /* Actual stipend line color */
            --buying-power-1990: #4ecdc4;      /* 1990 buying power color */
            --buying-power-2000: #45b7d1;      /* 2000 buying power color */
            --buying-power-2007: #bf7bff;      /* 2007 buying power color */
            --buying-power-2015: #ffd93d;      /* 2015 buying power color */
            --all-button-color: #bcbcbc;       /* Grey for "Show All" button */
            --default-border: #6c757d;         /* Default border color */
            --bar-color: #45b7d1;              /* Bar chart color */
            --bar-hover-color: #3890a4;        /* Bar chart hover color */
        }

        /* Default button styles */
        button {
            background: transparent;
            color: var(--default-border);
            border: 2px solid var(--default-border);
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        /* Individual button colors */
        #btn-all {
            color: var(--all-button-color);
            border-color: var(--all-button-color);
        }

        #btn-all.active {
            background: var(--all-button-color);
            color: black;
        }

        #btn-actual {
            color: var(--stipend-color);
            border-color: var(--stipend-color);
        }

        #btn-actual.active {
            background: var(--stipend-color);
            color: black;
        }

        #btn-1990 {
            color: var(--buying-power-1990);
            border-color: var(--buying-power-1990);
        }

        #btn-1990.active {
            background: var(--buying-power-1990);
            color: black;
        }

        #btn-2000 {
            color: var(--buying-power-2000);
            border-color: var(--buying-power-2000);
        }

        #btn-2000.active {
            background: var(--buying-power-2000);
            color: black;
        }

        #btn-2007 {
            color: var(--buying-power-2007);
            border-color: var(--buying-power-2007);
        }

        #btn-2007.active {
            background: var(--buying-power-2007);
            color: black;
        }

        #btn-2015 {
            color: var(--buying-power-2015);
            border-color: var(--buying-power-2015);
        }

        #btn-2015.active {
            background: var(--buying-power-2015);
            color: black;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid #333;
        }

        /* Grid styles for line chart */
        .grid line {
            stroke: #333;
            stroke-opacity: 0.7;
            stroke-width: 1;
        }
        
        .grid .domain {
            stroke: none;
        }

        /* Bar chart specific styles */
        .bar {
            fill: var(--bar-color);
            transition: fill 0.3s ease;
        }
        
        .bar:hover {
            fill: var(--bar-hover-color);
        }
        
        .axis {
            font-size: 12px;
            color: white;
        }
        
        .axis-label {
            font-size: 14px;
            font-weight: bold;
            fill: white;
        }
        
        .bar-grid line {
            stroke: #333;
            stroke-dasharray: 2,2;
        }
        
        .insights-text {
            font-size: 12px;
            fill: #ccc;
        }

        /* Make axis text white for better visibility */
        .axis text {
            fill: white;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>IIT Bombay's Stipend Analysis Dashboard</h1>
        </div>
        
       

        <!-- Multi-line Analysis Chart -->
        <div class="chart-container">
            <div class="chart-title">Analyzing <b>stipend trends</b> and <b>change in buying power</b> (inflation rate) from 1990-2024</div>
            <div style="font-size: 12px; margin-bottom: 10px; color: #ccc;">
                <p>Stipends were adjusted during the years 1999, 2007 and 2015 to match the inflation (buying power) during that year. 
                    <br> The graph tries to see the change in buying power of the stipend from the year it was adjusted. </p>
                <i style="color: #ffd93d;">Note: 
                    <br> Click buttons to toggle visibility of different inflation-adjusted stipend lines.
                    <br> Hover over points to see exact values.
                    <br>
                </i>
            </div>
            <div class="controls">
                <button id="btn-all" class="active">Show All</button>
                <button id="btn-actual">Actual Stipend</button>
                <button id="btn-1990">Inflation since 1990</button>
                <button id="btn-2000">Inflation since 1999</button>
                <button id="btn-2007">Inflation since 2007</button>
                <button id="btn-2015">Inflation since 2015</button>
            </div>
            <svg id="multi-line-chart"></svg>
        </div>

         <!-- Original Bar Chart -->
        <div class="chart-container">
            <div class="chart-title">Your stipend’s value based on 1999’s buying power</div>
            <div style="font-size: 12px; margin-bottom: 15px; color: #ccc;">
                <p>Value in 1999 rupees (adjusted for inflation) - Shows the dramatic decline in real purchasing power</p>
            </div>
            <div id="bar-chart"></div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Original bar chart data
        const barChartData = [
            {year: 1999, value: 5000},
            {year: 2000, value: 4807},
            {year: 2001, value: 4632},
            {year: 2002, value: 4441},
            {year: 2003, value: 4279},
            {year: 2004, value: 4123},
            {year: 2005, value: 3955},
            {year: 2006, value: 3739},
            {year: 2007, value: 5623},
            {year: 2008, value: 5190},
            {year: 2009, value: 4681},
            {year: 2010, value: 4179},
            {year: 2011, value: 3838},
            {year: 2012, value: 3505},
            {year: 2013, value: 3186},
            {year: 2014, value: 2987},
            {year: 2015, value: 4413},
            {year: 2016, value: 4205},
            {year: 2017, value: 4070},
            {year: 2018, value: 3915},
            {year: 2019, value: 3775},
            {year: 2020, value: 3540},
            {year: 2021, value: 3367},
            {year: 2022, value: 3156},
            {year: 2023, value: 2987},
            {year: 2024, value: 2846}
        ];

        // Multi-line chart data
        const multiLineData = [
            { year: "1990", stipend: 2500, buyingPower1990: 2500 },
            { year: "1991", stipend: 2500, buyingPower1990: 2846.76 },
            { year: "1992", stipend: 2500, buyingPower1990: 3182.33 },
            { year: "1993", stipend: 2500, buyingPower1990: 3383.67 },
            { year: "1994", stipend: 2500, buyingPower1990: 3730.43 },
            { year: "1995", stipend: 2500, buyingPower1990: 4111.86 },
            { year: "1996", stipend: 2500, buyingPower1990: 4480.98 },
            { year: "1997", stipend: 2500, buyingPower1990: 4802.01 },
            { year: "1998", stipend: 2500, buyingPower1990: 5437.36 },
            { year: "1999", stipend: 5000, buyingPower1990: 5691.28, buyingPower2000: 5000.00 },
            { year: "2000", stipend: 5000, buyingPower1990: 5919.46, buyingPower2000: 5228.19 },
            { year: "2001", stipend: 5000, buyingPower1990: 6143.18, buyingPower2000: 5451.90 },
            { year: "2002", stipend: 5000, buyingPower1990: 6407.16, buyingPower2000: 5715.88 },
            { year: "2003", stipend: 5000, buyingPower1990: 6651.01, buyingPower2000: 5959.73 },
            { year: "2004", stipend: 5000, buyingPower1990: 6901.57, buyingPower2000: 6210.29 },
            { year: "2005", stipend: 5000, buyingPower1990: 7194.63, buyingPower2000: 6503.36 },
            { year: "2006", stipend: 5000, buyingPower1990: 7611.67, buyingPower2000: 6920.39 },
            { year: "2007", stipend: 8000, buyingPower1990: 8096.75, buyingPower2000: 7405.48, buyingPower2007: 8000.00 },
            { year: "2008", stipend: 8000, buyingPower1990: 8772.77, buyingPower2000: 8081.50, buyingPower2007: 8676.02 },
            { year: "2009", stipend: 8000, buyingPower1990: 9727.45, buyingPower2000: 9036.18, buyingPower2007: 9630.70 },
            { year: "2010", stipend: 8000, buyingPower1990: 10893.72, buyingPower2000: 10202.44, buyingPower2007: 10796.97 },
            { year: "2011", stipend: 8000, buyingPower1990: 11864.54, buyingPower2000: 11173.27, buyingPower2007: 11767.79 },
            { year: "2012", stipend: 8000, buyingPower1990: 12989.18, buyingPower2000: 12297.91, buyingPower2007: 12892.43 },
            { year: "2013", stipend: 8000, buyingPower1990: 14290.42, buyingPower2000: 13599.15, buyingPower2007: 14193.67 },
            { year: "2014", stipend: 8000, buyingPower1990: 15242.97, buyingPower2000: 14551.70, buyingPower2007: 15146.22 },
            { year: "2015", stipend: 12400, buyingPower1990: 15990.94, buyingPower2000: 15299.67, buyingPower2007: 15894.19, buyingPower2015: 12400.00 },
            { year: "2016", stipend: 12400, buyingPower1990: 16782.21, buyingPower2000: 16090.93, buyingPower2007: 16685.46, buyingPower2015: 13191.27 },
            { year: "2017", stipend: 12400, buyingPower1990: 17340.75, buyingPower2000: 16649.47, buyingPower2007: 17244.00, buyingPower2015: 13749.81 },
            { year: "2018", stipend: 12400, buyingPower1990: 18023.77, buyingPower2000: 17332.50, buyingPower2007: 17927.02, buyingPower2015: 14432.83 },
            { year: "2019", stipend: 12400, buyingPower1990: 18695.97, buyingPower2000: 18004.69, buyingPower2007: 18599.22, buyingPower2015: 15105.03 },
            { year: "2020", stipend: 12400, buyingPower1990: 19934.28, buyingPower2000: 19243.01, buyingPower2007: 19837.53, buyingPower2015: 16343.34 },
            { year: "2021", stipend: 12400, buyingPower1990: 20957.19, buyingPower2000: 20265.92, buyingPower2007: 20860.44, buyingPower2015: 17366.25 },
            { year: "2022", stipend: 12400, buyingPower1990: 22361.12, buyingPower2000: 21669.85, buyingPower2007: 22264.37, buyingPower2015: 18770.18 },
            { year: "2023", stipend: 12400, buyingPower1990: 23624.34, buyingPower2000: 22933.06, buyingPower2007: 23527.58, buyingPower2015: 20033.39 },
            { year: "2024", stipend: 12400, buyingPower1990: 24794.46, buyingPower2000: 24103.18, buyingPower2007: 24697.71, buyingPower2015: 21203.52 }
        ];

        // Color scheme
        const colors = {
            stipend: '#ff6b6b',
            buyingPower1990: '#4ecdc4',
            buyingPower2000: '#45b7d1',
            buyingPower2007: '#bf7bff',
            buyingPower2015: '#ffeead'
        };

        const lineLabels = {
            stipend: 'Actual Stipend',
            buyingPower1990: 'Stipend if inflation calculated from 1990',
            buyingPower2000: 'Stipend if inflation calculated from 1999',
            buyingPower2007: 'Stipend if inflation calculated from 2007',
            buyingPower2015: 'Stipend if inflation calculated from 2015'
        };

        // Tooltip
        const tooltip = d3.select('#tooltip');

        // Create Bar Chart
        function createBarChart() {
            const margin = {top: 80, right: 30, bottom: 60, left: 70};
            const width = 1000 - margin.left - margin.right;
            const height = 500 - margin.top - margin.bottom;

            // Clear existing chart
            d3.select("#bar-chart").selectAll("*").remove();

            // Create SVG
            const svg = d3.select("#bar-chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales
            const xScale = d3.scaleBand()
                .domain(barChartData.map(d => d.year))
                .range([0, width])
                .padding(0.1);

            const yScale = d3.scaleLinear()
                .domain([0, d3.max(barChartData, d => d.value)])
                .nice()
                .range([height, 0]);

            // Add grid lines
            const grid = g.append("g")
                .attr("class", "bar-grid");

            grid.selectAll("line")
                .data(yScale.ticks())
                .enter()
                .append("line")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", d => yScale(d))
                .attr("y2", d => yScale(d))
                .attr("stroke", "#333")
                .attr("stroke-dasharray", "2,2");

            // Create bars
            g.selectAll(".bar")
                .data(barChartData)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => xScale(d.year) + 4)
                .attr("width", xScale.bandwidth()-5)
                .attr("y", d => yScale(d.value))
                .attr("height", d => height - yScale(d.value))
                .on("mouseover", function(event, d) {
                    d3.select(this).attr("fill", "var(--bar-hover-color)");
                    tooltip
                        .style("opacity", 1)
                        .html(`<strong>Year:</strong> ${d.year}<br><strong>Value:</strong> ₹${d.value.toLocaleString()}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function(d) {
                    d3.select(this).attr("fill", "var(--bar-color)");
                    tooltip.style("opacity", 0);
                });

            // Add value labels on bars
            g.selectAll(".bar-label")
                .data(barChartData)
                .enter()
                .append("text")
                .attr("class", "bar-label")
                .attr("x", d => xScale(d.year) + xScale.bandwidth() / 2)
                .attr("y", d => yScale(d.value) + 20)
                .attr("text-anchor", "middle")
                .attr("dy", "5px")
                .attr("transform", d => `rotate(-90, ${xScale(d.year) + xScale.bandwidth() / 2}, ${yScale(d.value) + 20})`)
                .attr("dx", "-15px")
                .style("font-size", "13px")
                .style("fill", "#222")
                .style("font-weight", "bold")
                .text(d => `₹${d.value.toLocaleString()}`);

            // X axis
            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)")
                .style("fill", "white");

            // Y axis
            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(yScale)
                    .ticks(6)
                    .tickFormat(d => `₹${d.toLocaleString()}`))
                .selectAll("text")
                .style("fill", "white");

            // X axis label
            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "middle")
                .attr("x", width / 2 + margin.left)
                .attr("y", height + margin.top + 50)
                .text("Year");

            // Y axis label
            svg.append("text")
                .attr("class", "axis-label")
                .attr("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2 - margin.top)
                .attr("y", 20)
                .text("Value (1999 Rupees)");

            // Add insights
            const insights = svg.append("g")
                .attr("transform", `translate(${margin.left + 10}, ${margin.top - 30})`);

            insights.append("text")
                .attr("x", 0)
                .attr("y", 0)
                .attr("class", "insights-text")
                .text(`Peak: ₹${d3.max(barChartData, d => d.value).toLocaleString()} (2007) | Latest: ₹${barChartData[barChartData.length-1].value.toLocaleString()} (2024)`);

            insights.append("text")
                .attr("x", 0)
                .attr("y", 15)
                .attr("class", "insights-text")
                .text(`Total decline: ${Math.round((1 - barChartData[barChartData.length-1].value / barChartData[0].value) * 100)}% from 1999 baseline`);
        }

        function showTooltip(event, d, metric) {
            const value = d[metric];
            if (value === undefined) return;
            
            let tooltipContent = `
                <strong>Year:</strong> ${d.year}<br>
                <strong>${lineLabels[metric]}:</strong> ₹${value.toLocaleString()}
            `;
            
            // Add difference calculation for buying power metrics (not for actual stipend)
            if (metric !== 'stipend' && d.stipend !== undefined) {
                const difference = value - d.stipend;
                const differenceText = difference > 0 
                    ? `₹${difference.toLocaleString()}` 
                    : `₹0 (stipend is higher)`;
                
                tooltipContent += `<br><strong>Stipend that you are not getting:</strong> ${differenceText}`;
            }
            
            tooltip
                .style('opacity', 1)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 10) + 'px')
                .html(tooltipContent);
        }

        function hideTooltip() {
            tooltip.style('opacity', 0);
        }

        function addGrid(svg, xScale, yScale, width, height) {
            // Add vertical grid lines
            svg.append("g")
                .attr("class", "grid")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale)
                    .tickSize(-height)
                    .tickFormat("")
                );

            // Add horizontal grid lines
            svg.append("g")
                .attr("class", "grid")
                .attr("transform", `translate(${width},0)`)
                .call(d3.axisRight(yScale)
                    .tickSize(-width)
                    .tickFormat("")
                );
        }

        // Multi-line Chart with All Buying Powers
        function createMultiLineChart(visibleLines = ['stipend', 'buyingPower2000']) {
            const width = 900;
            const height = 400;
            const margin = { top: 20, right: 150, bottom: 60, left: 80 };

            d3.select('#multi-line-chart').selectAll("*").remove();
            
            const svg = d3.select('#multi-line-chart')
                          .attr('width', width + margin.left + margin.right)
                          .attr('height', height + margin.top + margin.bottom)
                          .append('g')
                          .attr('transform', `translate(${margin.left-40},${margin.top})`);

            const xScale = d3.scalePoint()
                             .domain(multiLineData.map(d => d.year))
                             .range([0, width]);

            const yScale = d3.scaleLinear()
                             .domain([0, 26000])
                             .range([height, 0]);

            // Add grid lines first (so they appear behind the data)
            addGrid(svg, xScale, yScale, width, height);

            // Add axes
            svg.append('g')
               .attr('transform', `translate(0,${height})`)
               .call(d3.axisBottom(xScale))
               .selectAll('text')
               .style('text-anchor', 'end')
               .attr('transform', 'rotate(-45)')
               .style('fill', 'white');

            svg.append('g')
               .attr('transform', `translate(${width},0)`) 
               .call(d3.axisRight(yScale)
                   .tickFormat(d => `₹${d.toLocaleString()}`))
               .selectAll('text')
               .style('fill', 'white');

            // Add axis labels
            svg.append('text')
               .attr('transform', 'rotate(-90)')
               .attr('y', width + margin.right - 100)
               .attr('x', 0 - (height / 2))
               .attr('dy', '1em')
               .style('text-anchor', 'middle')
               .text('Per Month Amount (₹)')
               .style('fill', 'white');

            svg.append('text')
               .attr('transform', `translate(${width / 2}, ${height + margin.bottom - 10})`)
               .style('text-anchor', 'middle')
               .style('fill', 'white')
               .text('Year');

            // Add lines
            visibleLines.forEach(metric => {
                const line = d3.line()
                              .defined(d => d[metric] !== undefined)
                              .x(d => xScale(d.year))
                              .y(d => yScale(d[metric]));

                svg.append('path')
                   .datum(multiLineData.filter(d => d[metric] !== undefined))
                   .attr('fill', 'none')
                   .attr('stroke', colors[metric])
                   .attr('stroke-width', 2)
                   .attr('d', line);

                // Add dots
                svg.selectAll(`.dots-${metric}`)
                   .data(multiLineData.filter(d => d[metric] !== undefined))
                   .enter()
                   .append('circle')
                   .attr('class', `dots-${metric}`)
                   .attr('cx', d => xScale(d.year))
                   .attr('cy', d => yScale(d[metric]))
                   .attr('r', 5)
                   .attr('fill', colors[metric])
                   .on('mouseover', (event, d) => showTooltip(event, d, metric))
                   .on('mouseout', hideTooltip);
            });
        }

        // Track which lines are currently visible
        let visibleLines = new Set(['stipend', 'buyingPower2000']);

        // Button controls
        document.addEventListener('DOMContentLoaded', () => {
            // Create both charts
            createBarChart();
            createMultiLineChart(Array.from(visibleLines));
            
            // Initialize button states
            updateButtonStates();

            // Button event listeners for individual toggles
            document.getElementById('btn-actual').addEventListener('click', function() {
                toggleLine('stipend', this);
            });

            document.getElementById('btn-1990').addEventListener('click', function() {
                toggleLine('buyingPower1990', this);
            });

            document.getElementById('btn-2000').addEventListener('click', function() {
                toggleLine('buyingPower2000', this);
            });

            document.getElementById('btn-2007').addEventListener('click', function() {
                toggleLine('buyingPower2007', this);
            });

            document.getElementById('btn-2015').addEventListener('click', function() {
                toggleLine('buyingPower2015', this);
            });

            // Special handlers for "All" button
            document.getElementById('btn-all').addEventListener('click', function() {
                toggleAllLines(this);
            });
        });

        function toggleLine(lineKey, button) {
            if (visibleLines.has(lineKey)) {
                visibleLines.delete(lineKey);
                button.classList.remove('active');
            } else {
                visibleLines.add(lineKey);
                button.classList.add('active');
            }
            
            // Update the "All" button state
            updateAllButtonState();
            
            // Redraw chart with current visible lines
            createMultiLineChart(Array.from(visibleLines));
        }

        function toggleAllLines(allButton) {
            const allLineKeys = ['stipend', 'buyingPower1990', 'buyingPower2000', 'buyingPower2007', 'buyingPower2015'];
            
            if (visibleLines.size === allLineKeys.length) {
                // All are visible, hide all
                visibleLines.clear();
                allButton.classList.remove('active');
            } else {
                // Some or none are visible, show all
                visibleLines = new Set(allLineKeys);
                allButton.classList.add('active');
            }
            
            // Update individual button states
            updateButtonStates();
            
            // Redraw chart
            createMultiLineChart(Array.from(visibleLines));
        }

        function updateButtonStates() {
            // Update individual button states
            document.getElementById('btn-actual').classList.toggle('active', visibleLines.has('stipend'));
            document.getElementById('btn-1990').classList.toggle('active', visibleLines.has('buyingPower1990'));
            document.getElementById('btn-2000').classList.toggle('active', visibleLines.has('buyingPower2000'));
            document.getElementById('btn-2007').classList.toggle('active', visibleLines.has('buyingPower2007'));
            document.getElementById('btn-2015').classList.toggle('active', visibleLines.has('buyingPower2015'));
            
            // Update "All" button state
            updateAllButtonState();
        }

        function updateAllButtonState() {
            const allButton = document.getElementById('btn-all');
            const allLineKeys = ['stipend', 'buyingPower1990', 'buyingPower2000', 'buyingPower2007', 'buyingPower2015'];
            
            // "All" button is active only when all lines are visible
            allButton.classList.toggle('active', visibleLines.size === allLineKeys.length);
        }
    </script>
</body>
</html>